<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DE picker</title>
    <link href="style.css" rel="stylesheet" />
    <style>
    </style>
  </head>
  <body>
    <script type="module">
      const currLaunchDE = new URLSearchParams(location.search).get("launching");

      document.querySelector("#de-image").src = `/assets/${currLaunchDE}.svg`;

      function htmlEscape(text) {
        return String(text)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      const html = (strings, ...values) =>
        String.raw({ raw: strings }, ...values.map(htmlEscape));

      const dataset = await fetch("/dataset.json").then((v) => v.json());


      async function update() {
        const [currentlyLaunching, results] = await fetch("/status").then((v) => v.json());

        const error = results.at(-1)?.[1];
        const isEnd = results.at(-1)?.[2];

        const data = dataset[currentlyLaunching];

        document.querySelector("#de-image-status").dataset.maskvariant = error
          ? "error"
          : isEnd
            ? ""
            : "pending";

        document.querySelector("#status").innerText = error
          ? `Failed to launch ${currLaunchDE}!`
          : `Launching ${currLaunchDE}...`;

        if (error) {
          clearInterval(update);

          document.querySelector("#back_to_home").style.display = "block";
        }
      }

      await update();

      setInterval(update, 100);
    </script>

    <header>
      <h1 id="status"></h1>
    </header>

    <main>
      <div class="composite-image">
        <div class="above-image" id="de-image-status"></div>
        <img id="de-image" />
      </div>
    </main>

    <footer>
      <a id="back_to_home" style="display: none;">Back to Home</a>
      <a>Copy trace</a>
    </footer>

    <script src="/aside.js"></script>
  </body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DE picker</title>
    <link href="style.css" rel="stylesheet" />
    <style>
    </style>
  </head>
  <body>
    <script type="module">
      function htmlEscape(text) {
        return String(text)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      const html = (strings, ...values) =>
        String.raw({ raw: strings }, ...values.map(htmlEscape));

      const dataset = await fetch("/dataset.json").then((v) => v.json());

      async function update() {
        const [currentlyLaunching, launchingCounter, error] = await fetch("/status").then((v) => v.json());

        const data = dataset[currentlyLaunching];

        document.querySelector("main").innerHTML = enabled.map((id) => html`
          <a class="de-card" href="/start/${id}">
            <img src="/assets/${id}.svg" />
            <div class="text">
              ${dataset[id].name}
              <small>${dataset[id].description}</small>
            </div>
          </a>
        `).join("");

        document.querySelectorAll(".status").forEach((v) => {
          if (error) {
            v.innerText = `Failed launching ${currentlyLaunching}!`;
          }
        });
      }

      await update();
    </script>

    <header>
      <h1 class="status"></h1>
    </header>

    <main></main>

    <footer>
      <a>Log out</a>
      <a>Shutdown</a>
    </footer>
  </body>
</html>
